import { decodeAbiParameters } from 'viem';

// helper code for getting the proposal data from the event data, useful next time when we will create another app for different proposal

const PWN_INSTALLMENTS_PRODUCT_PROPOSAL_STRUCT = [{
    type: "tuple",
    components: [
      { type: "address", name: "collateralAddress" },
      { type: "address", name: "creditAddress" },
      { type: "address[]", name: "feedIntermediaryDenominations" },
      { type: "bool[]", name: "feedInvertFlags" },
      { type: "uint256", name: "loanToValue" },
      { type: "uint256", name: "interestAPR" },
      { type: "uint256", name: "postponement" },
      { type: "uint256", name: "duration" },
      { type: "uint256", name: "minCreditAmount" },
      { type: "uint256", name: "availableCreditLimit" },
      { type: "bytes32", name: "utilizedCreditId" },
      { type: "uint256", name: "nonceSpace" },
      { type: "uint256", name: "nonce" },
      { type: "uint256", name: "expiration" },
      { type: "bytes32", name: "proposerSpecHash" },
      { type: "bool", name: "isProposerLender" },
      { type: "address", name: "loanContract" },
    ],
}] as const;

// taken from the ProposalAcceptable event data... this event is emitted when a CrowdsourceLenderVault is deployed
// e.g. this one: https://sepolia.etherscan.io/tx/0x371aee4eccee8e0c443e5e2d6ff9db62dfe4b8a7c6dcb54049ad5a70eab850f5#eventlog#102
// TODO move this + addresses to .env file
const PROPOSAL_DATA = "0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000002e000000000000000000000000000000000000000000000000000000000000000200000000000000000000000007b79995e5f793a07bc00c21412e50ecae098e7f90000000000000000000000006d906e526a4e2ca02097ba9d0caa3c382f52278e000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000001d4c00000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000000004b00000000000000000000000000000000000000000000000000000000000001c200000000000000000000000000000000000000000000000000000000000002710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000691d418c0a15ef452ce6b253cfb59618eae80cdb89f986316d692b15acd758f8847504290000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c58791ec351349a82036ae712976109c10e3421700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000348000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"

// decodeAbiParameters expects raw ABI-encoded parameters, not the extra encoding that bytes adds.
const proposalDataRaw = decodeAbiParameters([{ type: 'bytes' }], PROPOSAL_DATA)[0]; // this is the raw struct-encoded bytes

export const proposal = decodeAbiParameters(PWN_INSTALLMENTS_PRODUCT_PROPOSAL_STRUCT, proposalDataRaw)[0]

export type InstallmentsProposalStruct = typeof proposal
