import { decodeAbiParameters } from 'viem';

// helper code for getting the proposal data from the event data, useful next time when we will create another app for different proposal

const PWN_INSTALLMENTS_PRODUCT_PROPOSAL_STRUCT = [{
    type: "tuple",
    components: [
      { type: "address", name: "collateralAddress" },
      { type: "address", name: "creditAddress" },
      { type: "address[]", name: "feedIntermediaryDenominations" },
      { type: "bool[]", name: "feedInvertFlags" },
      { type: "uint256", name: "loanToValue" },
      { type: "uint256", name: "interestAPR" },
      { type: "uint256", name: "postponement" },
      { type: "uint256", name: "duration" },
      { type: "uint256", name: "minCreditAmount" },
      { type: "uint256", name: "availableCreditLimit" },
      { type: "bytes32", name: "utilizedCreditId" },
      { type: "uint256", name: "nonceSpace" },
      { type: "uint256", name: "nonce" },
      { type: "uint256", name: "expiration" },
      { type: "bytes32", name: "proposerSpecHash" },
      { type: "bool", name: "isProposerLender" },
      { type: "address", name: "loanContract" },
    ],
}] as const;

// taken from the ProposalAcceptable event data... this event is emitted when a CrowdsourceLenderVault is deployed
// e.g. this one: https://sepolia.etherscan.io/tx/0x371aee4eccee8e0c443e5e2d6ff9db62dfe4b8a7c6dcb54049ad5a70eab850f5#eventlog#102
// const PROPOSAL_DATA = "0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000002e000000000000000000000000000000000000000000000000000000000000000200000000000000000000000007b79995e5f793a07bc00c21412e50ecae098e7f900000000000000000000000094a9d9ac8a22534e3faca9f4e7f2e2cf85d5e4c8000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000001d4c00000000000000000000000000000000000000000000000000000000000003e80000000000000000000000000000000000000000000000000000000000278d000000000000000000000000000000000000000000000000000000000003c26700000000000000000000000000000000000000000000000000000000012a05f2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006966bfb8d2ce70a0e5bd35957b2e6d7db964e1110927a509cd3135c37a588b99172aea4600000000000000000000000000000000000000000000000000000000000000010000000000000000000000007f53449251ef28991c99ea25698b37bc13b173b800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000348000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"

const PROPOSAL_DATA = "0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000007b79995e5f793a07bc00c21412e50ecae098e7f9000000000000000000000000f8fb3713d459d7c1018bd0a49d19b4c44290ebe5000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000001d4c00000000000000000000000000000000000000000000000000000000000003e80000000000000000000000000000000000000000000000000000000000278d000000000000000000000000000000000000000000000000000000000003c2670000000000000000000000000000000000000000000000001b1ae4d6e2ef5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006967c044c7bb3e808c2dd265821a971386017fe296f98f5f78e3617e543cc169185116bc00000000000000000000000000000000000000000000000000000000000000010000000000000000000000007f53449251ef28991c99ea25698b37bc13b173b8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"

// decodeAbiParameters expects raw ABI-encoded parameters, not the extra encoding that bytes adds.
const proposalDataRaw = decodeAbiParameters([{ type: 'bytes' }], PROPOSAL_DATA)[0]; // this is the raw struct-encoded bytes

export const proposal = decodeAbiParameters(PWN_INSTALLMENTS_PRODUCT_PROPOSAL_STRUCT, proposalDataRaw)[0]

export type InstallmentsProposalStruct = typeof proposal
