import { decodeAbiParameters } from 'viem';

// helper code for getting the proposal data from the event data, useful next time when we will create another app for different proposal

const PWN_INSTALLMENTS_PRODUCT_PROPOSAL_STRUCT = [{
    type: "tuple",
    components: [
      { type: "address", name: "collateralAddress" },
      { type: "address", name: "creditAddress" },
      { type: "address[]", name: "feedIntermediaryDenominations" },
      { type: "bool[]", name: "feedInvertFlags" },
      { type: "uint256", name: "loanToValue" },
      { type: "uint256", name: "interestAPR" },
      { type: "uint256", name: "postponement" },
      { type: "uint256", name: "duration" },
      { type: "uint256", name: "minCreditAmount" },
      { type: "uint256", name: "availableCreditLimit" },
      { type: "bytes32", name: "utilizedCreditId" },
      { type: "uint256", name: "nonceSpace" },
      { type: "uint256", name: "nonce" },
      { type: "uint256", name: "expiration" },
      { type: "bytes32", name: "proposerSpecHash" },
      { type: "bool", name: "isProposerLender" },
      { type: "address", name: "allowedAcceptor" },
      { type: "address", name: "loanContract" },
    ],
}] as const;

// taken from the ProposalAcceptable event data... this event is emitted when a CrowdsourceLenderVault is deployed
// e.g. this one: https://sepolia.etherscan.io/tx/0x371aee4eccee8e0c443e5e2d6ff9db62dfe4b8a7c6dcb54049ad5a70eab850f5#eventlog#102
// TODO move this + addresses to .env file
// const PROPOSAL_DATA = "0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000200000000000000000000000007b79995e5f793a07bc00c21412e50ecae098e7f90000000000000000000000006d906e526a4e2ca02097ba9d0caa3c382f52278e000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000002800000000000000000000000000000000000000000000000000000000000001d4c00000000000000000000000000000000000000000000000000000000000000c80000000000000000000000000000000000000000000000000000000000f0c8a0000000000000000000000000000000000000000000000000000000000967d640000000000000000000000000000000000000000000000000000000000000271000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000069a7424ca94a28763d2f30bbef2e884de6a8f07b3e443d09ba083a17616ec7025489538500000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c58791ec351349a82036ae712976109c10e3421700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000348000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"
const PROPOSAL_DATA = "0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000003400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000cd5fe23c85820f7b72d0926fc9b05b43e359b7ee000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000002a00000000000000000000000000000000000000000000000000000000000001d4c00000000000000000000000000000000000000000000000000000000000000fa0000000000000000000000000000000000000000000000000000000000f0c8a0000000000000000000000000000000000000000000000000000000000967d64000000000000000000000000000000000000000000000000000000029e8d6080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000069a8084bbabe1a6d8657edf32b45d6543c91fc9ee29544acfd95deda4c5fd830d7a00eb100000000000000000000000000000000000000000000000000000000000000010000000000000000000000008a7a728a181e674833e018706422cb28543abd87000000000000000000000000c58791ec351349a82036ae712976109c10e3421700000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000348000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001"

// decodeAbiParameters expects raw ABI-encoded parameters, not the extra encoding that bytes adds.
const proposalDataRaw = decodeAbiParameters([{ type: 'bytes' }], PROPOSAL_DATA)[0]; // this is the raw struct-encoded bytes

export const proposal = decodeAbiParameters(PWN_INSTALLMENTS_PRODUCT_PROPOSAL_STRUCT, proposalDataRaw)[0]

export type InstallmentsProposalStruct = typeof proposal
